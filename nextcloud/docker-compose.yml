version: '3'

services:

  nextcloud:
    image: nextcloud:latest
    volumes:
      - nextcloud:/var/www/html # Pulls from /var/lib/docker/volumes/nextcloud_nextcloud/_data/
      #- ./nextcloud/config:/var/www/html/config # Pulls from local dir
      #- /mnt/someHDD/nextcloud:/mnt/hdd # Pulls from root
    environment:
      - POSTGRES_DB=${POSTGRES_DB}
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_HOST=${POSTGRES_HOST}
      - NEXTCLOUD_ADMIN_USER=${NEXTCLOUD_ADMIN_USER}
      - NEXTCLOUD_ADMIN_PASSWORD=${NEXTCLOUD_ADMIN_PASSWORD}

    networks:
      - traefik-public
      
    labels:
      - traefik.tags=traefik-public
      - traefik.docker.network=traefik-public
      - traefik.enable=true
      - traefik.frontend.rule=Host:cloud.unitygm.net
      - traefik.port=80
      # Traefik service that listens to HTTP
      - traefik.redirectorservice.frontend.entryPoints=http
      - traefik.redirectorservice.frontend.redirect.entryPoint=https
      # Traefik service that listens to HTTPS
      - traefik.webservice.frontend.entryPoints=https

 
networks:
  traefik-public:
    external: true

volumes:
  nextcloud:
